# 合同管理模块前端开发提示词

## 项目概述
基于 ruoyi-vue-pro 框架开发合同管理模块的前端界面，实现完整的合同生命周期管理，包括创建、审核、签署、履行、归档等功能。

## 技术栈要求
- **框架**: Vue 3 + TypeScript
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router 4
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **代码规范**: ESLint + Prettier

## 页面结构设计

### 1. 主要页面列表
```
/contract
├── /list                    # 合同列表页
├── /create                  # 创建合同页
├── /edit/:id               # 编辑合同页
├── /detail/:id             # 合同详情页
├── /sign/:id/:partyId      # 合同签署页
├── /template               # 合同模板管理
├── /type                   # 合同类型管理
└── /statistics             # 合同统计页
```

### 2. 核心组件设计

#### 2.1 合同列表页 (ContractList.vue)
**功能要求:**
- 支持多条件筛选：合同状态、类型、企业、时间范围
- 表格展示：合同编号、名称、类型、状态、金额、创建时间、操作
- 状态标签显示：不同状态用不同颜色的标签
- 批量操作：批量删除、批量导出
- 分页加载
- 快速操作：查看、编辑、删除、签署

**状态枚举映射:**
```typescript
const CONTRACT_STATUS = {
  0: { label: '草稿', type: 'info' },
  1: { label: '待审核', type: 'warning' },
  2: { label: '审核通过', type: 'success' },
  3: { label: '待签署', type: 'primary' },
  4: { label: '签署中', type: 'warning' },
  5: { label: '已生效', type: 'success' },
  6: { label: '已履行', type: 'success' },
  7: { label: '即将到期', type: 'warning' },
  8: { label: '已到期', type: 'danger' },
  9: { label: '已解除', type: 'info' },
  10: { label: '已作废', type: 'danger' },
  11: { label: '已归档', type: 'info' }
}
```

#### 2.2 合同创建/编辑页 (ContractForm.vue)
**表单字段:**
- 基本信息：合同名称、类型、模板选择
- 企业信息：主要负责企业、参与方企业
- 合同内容：富文本编辑器或模板填充
- 金额信息：总金额、币种
- 时间信息：生效日期、到期日期
- 其他：优先级、备注

**表单验证规则:**
```typescript
const formRules = {
  contractName: [
    { required: true, message: '请输入合同名称', trigger: 'blur' },
    { min: 2, max: 100, message: '长度在 2 到 100 个字符', trigger: 'blur' }
  ],
  contractTypeId: [
    { required: true, message: '请选择合同类型', trigger: 'change' }
  ],
  primaryOwnerEnterpriseId: [
    { required: true, message: '请选择主要负责企业', trigger: 'change' }
  ]
}
```

#### 2.3 合同详情页 (ContractDetail.vue)
**功能模块:**
- 合同基本信息展示
- 版本历史管理
- 参与方信息和签署状态
- 附件管理
- 关联对象展示
- 操作日志
- 状态流转图

**Tab页设计:**
```vue
<el-tabs v-model="activeTab">
  <el-tab-pane label="合同详情" name="detail" />
  <el-tab-pane label="版本历史" name="versions" />
  <el-tab-pane label="参与方" name="parties" />
  <el-tab-pane label="附件管理" name="attachments" />
  <el-tab-pane label="关联对象" name="links" />
  <el-tab-pane label="操作日志" name="logs" />
</el-tabs>
```

#### 2.4 合同签署页 (ContractSign.vue)
**签署方式组件:**
- 点击确认签署
- 手写签名板
- 电子印章上传
- 密码验证

**签署流程:**
1. 合同内容展示和确认
2. 选择签署方式
3. 身份验证
4. 执行签署操作
5. 生成签署凭证

#### 2.5 状态流转组件 (ContractStatusFlow.vue)
**可视化展示合同状态流转:**
```vue
<el-steps :active="currentStep" finish-status="success">
  <el-step title="草稿" />
  <el-step title="待审核" />
  <el-step title="审核通过" />
  <el-step title="待签署" />
  <el-step title="签署中" />
  <el-step title="已生效" />
  <el-step title="已履行" />
  <el-step title="已归档" />
</el-steps>
```

## API 接口定义

### 1. 合同管理接口
```typescript
// api/contract/contract.ts
export interface ContractAPI {
  // 基础CRUD
  createContract(data: ContractCreateReq): Promise<number>
  updateContract(data: ContractUpdateReq): Promise<boolean>
  deleteContract(id: number): Promise<boolean>
  getContract(id: number): Promise<ContractResp>
  getContractPage(params: ContractPageReq): Promise<PageResult<ContractResp>>
  
  // 业务流程
  submitContract(id: number): Promise<boolean>
  approveContract(id: number, approved: boolean, remark?: string): Promise<boolean>
  initiateSignature(id: number): Promise<boolean>
  signContract(data: ContractSignReq): Promise<boolean>
  
  // 查询接口
  getContractByNo(contractNo: string): Promise<ContractResp>
  getExpiringContracts(days: number): Promise<ContractResp[]>
}
```

### 2. 数据类型定义
```typescript
// types/contract.ts
export interface ContractResp {
  id: number
  contractNo: string
  contractUuid: string
  contractName: string
  contractTypeId: number
  typeName?: string
  status: number
  statusName?: string
  isElectronic: boolean
  primaryOwnerEnterpriseId: number
  totalAmount?: number
  currency: string
  priorityLevel: number
  remark?: string
  createTime: string
  updateTime: string
}

export interface ContractCreateReq {
  contractName: string
  contractTypeId: number
  templateId?: number
  primaryOwnerEnterpriseId: number
  totalAmount?: number
  currency?: string
  priorityLevel?: number
  remark?: string
}

export interface ContractSignReq {
  contractId: number
  partyId: number
  signatureMethod: number
  signatoryName: string
  signPassword?: string
  signatureData?: string
}
```

## 组件开发规范

### 1. 组件命名规范
- 页面组件：大驼峰命名，如 `ContractList.vue`
- 业务组件：大驼峰命名，如 `ContractStatusFlow.vue`
- 通用组件：大驼峰命名，如 `SignaturePad.vue`

### 2. 文件结构规范
```
src/views/contract/
├── components/           # 合同模块专用组件
│   ├── ContractForm.vue
│   ├── ContractStatusFlow.vue
│   ├── SignaturePad.vue
│   └── PartyManager.vue
├── list/
│   └── index.vue        # 合同列表页
├── detail/
│   └── index.vue        # 合同详情页
├── sign/
│   └── index.vue        # 合同签署页
└── index.vue           # 合同管理主页
```

### 3. 状态管理规范
```typescript
// stores/contract.ts
export const useContractStore = defineStore('contract', {
  state: () => ({
    contractList: [] as ContractResp[],
    currentContract: null as ContractResp | null,
    contractTypes: [] as ContractType[],
    loading: false
  }),
  
  actions: {
    async fetchContractList(params: ContractPageReq) {
      this.loading = true
      try {
        const result = await contractApi.getContractPage(params)
        this.contractList = result.list
        return result
      } finally {
        this.loading = false
      }
    },
    
    async signContract(data: ContractSignReq) {
      await contractApi.signContract(data)
      // 更新本地状态
      if (this.currentContract) {
        this.currentContract.status = 4 // 签署中
      }
    }
  }
})
```

## 特殊功能实现

### 1. 富文本编辑器集成
```vue
<template>
  <div class="editor-container">
    <Toolbar
      :editor="editorRef"
      :defaultConfig="toolbarConfig"
      mode="default"
    />
    <Editor
      v-model="valueHtml"
      :defaultConfig="editorConfig"
      mode="default"
      @onCreated="handleCreated"
    />
  </div>
</template>

<script setup>
import { Editor, Toolbar } from '@wangeditor/editor-for-vue'

const editorConfig = {
  placeholder: '请输入合同内容...',
  MENU_CONF: {
    uploadImage: {
      server: '/api/infra/file/upload',
      fieldName: 'file'
    }
  }
}
</script>
```

### 2. 手写签名板实现
```vue
<template>
  <div class="signature-pad-container">
    <canvas
      ref="canvasRef"
      :width="canvasWidth"
      :height="canvasHeight"
      @mousedown="startDrawing"
      @mousemove="draw"
      @mouseup="stopDrawing"
      @touchstart="startDrawing"
      @touchmove="draw"
      @touchend="stopDrawing"
    />
    <div class="controls">
      <el-button @click="clear">清除</el-button>
      <el-button type="primary" @click="save">保存</el-button>
    </div>
  </div>
</template>

<script setup>
const canvasRef = ref<HTMLCanvasElement>()
const isDrawing = ref(false)

const startDrawing = (e: MouseEvent | TouchEvent) => {
  isDrawing.value = true
  const canvas = canvasRef.value!
  const ctx = canvas.getContext('2d')!
  const rect = canvas.getBoundingClientRect()
  
  const x = 'touches' in e ? e.touches[0].clientX - rect.left : e.clientX - rect.left
  const y = 'touches' in e ? e.touches[0].clientY - rect.top : e.clientY - rect.top
  
  ctx.beginPath()
  ctx.moveTo(x, y)
}

const save = () => {
  const canvas = canvasRef.value!
  const dataURL = canvas.toDataURL('image/png')
  emit('save', dataURL)
}
</script>
```

### 3. 文件上传组件
```vue
<template>
  <el-upload
    class="contract-upload"
    :action="uploadUrl"
    :headers="uploadHeaders"
    :on-success="handleSuccess"
    :on-error="handleError"
    :before-upload="beforeUpload"
    :file-list="fileList"
    multiple
    drag
  >
    <el-icon class="el-icon--upload"><upload-filled /></el-icon>
    <div class="el-upload__text">
      将文件拖到此处，或<em>点击上传</em>
    </div>
    <template #tip>
      <div class="el-upload__tip">
        支持 PDF、Word、图片格式，单个文件不超过 10MB
      </div>
    </template>
  </el-upload>
</template>
```

## 权限控制实现

### 1. 路由权限
```typescript
// router/modules/contract.ts
export default {
  path: '/contract',
  component: Layout,
  redirect: '/contract/list',
  name: 'Contract',
  meta: {
    title: '合同管理',
    icon: 'contract',
    roles: ['admin', 'contract:manager']
  },
  children: [
    {
      path: 'list',
      component: () => import('@/views/contract/list/index.vue'),
      name: 'ContractList',
      meta: {
        title: '合同列表',
        permissions: ['contract:contract:query']
      }
    },
    {
      path: 'create',
      component: () => import('@/views/contract/form/index.vue'),
      name: 'ContractCreate',
      meta: {
        title: '创建合同',
        permissions: ['contract:contract:create']
      }
    }
  ]
}
```

### 2. 按钮权限
```vue
<template>
  <div class="contract-actions">
    <el-button
      v-permission="['contract:contract:create']"
      type="primary"
      @click="handleCreate"
    >
      新建合同
    </el-button>
    
    <el-button
      v-permission="['contract:contract:approve']"
      v-if="contract.status === 1"
      type="success"
      @click="handleApprove"
    >
      审核通过
    </el-button>
    
    <el-button
      v-permission="['contract:contract:sign']"
      v-if="contract.status === 3"
      type="warning"
      @click="handleSign"
    >
      签署合同
    </el-button>
  </div>
</template>
```

## 响应式设计要求

### 1. 移动端适配
- 使用 Element Plus 的响应式栅格系统
- 表格在移动端转换为卡片布局
- 签署页面支持触摸操作

### 2. 断点设计
```scss
// 响应式断点
$breakpoints: (
  xs: 0,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1600px
);

// 移动端表格适配
@media (max-width: 768px) {
  .contract-table {
    .el-table__body-wrapper {
      overflow-x: auto;
    }
    
    .mobile-card {
      display: block;
      margin-bottom: 10px;
      padding: 15px;
      border: 1px solid #ebeef5;
      border-radius: 4px;
    }
  }
}
```

## 性能优化建议

### 1. 懒加载和代码分割
```typescript
// 路由懒加载
const ContractList = () => import('@/views/contract/list/index.vue')
const ContractDetail = () => import('@/views/contract/detail/index.vue')

// 组件懒加载
const SignaturePad = defineAsyncComponent(() => import('./SignaturePad.vue'))
```

### 2. 虚拟滚动
```vue
<!-- 大数据量表格使用虚拟滚动 -->
<el-table-v2
  :columns="columns"
  :data="contractList"
  :width="700"
  :height="400"
  fixed
/>
```

### 3. 缓存策略
```typescript
// 使用 keep-alive 缓存页面
<router-view v-slot="{ Component }">
  <keep-alive :include="['ContractList', 'ContractDetail']">
    <component :is="Component" />
  </keep-alive>
</router-view>

// API 请求缓存
const { data, isLoading } = useQuery({
  queryKey: ['contract', contractId],
  queryFn: () => contractApi.getContract(contractId),
  staleTime: 5 * 60 * 1000 // 5分钟缓存
})
```

## 测试要求

### 1. 单元测试
```typescript
// tests/contract/ContractForm.spec.ts
import { mount } from '@vue/test-utils'
import ContractForm from '@/views/contract/components/ContractForm.vue'

describe('ContractForm', () => {
  it('should validate required fields', async () => {
    const wrapper = mount(ContractForm)
    
    await wrapper.find('form').trigger('submit')
    
    expect(wrapper.find('.el-form-item__error').text())
      .toBe('请输入合同名称')
  })
})
```

### 2. E2E 测试
```typescript
// e2e/contract.spec.ts
import { test, expect } from '@playwright/test'

test('合同创建流程', async ({ page }) => {
  await page.goto('/contract/create')
  
  await page.fill('[data-testid="contract-name"]', '测试合同')
  await page.selectOption('[data-testid="contract-type"]', '1')
  await page.click('[data-testid="submit-btn"]')
  
  await expect(page.locator('.el-message--success')).toBeVisible()
})
```

## 部署和构建

### 1. 环境配置
```typescript
// .env.development
VITE_API_BASE_URL = 'http://localhost:8080'
VITE_UPLOAD_URL = 'http://localhost:8080/api/infra/file/upload'

// .env.production
VITE_API_BASE_URL = 'https://api.example.com'
VITE_UPLOAD_URL = 'https://api.example.com/api/infra/file/upload'
```

### 2. 构建优化
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'contract-vendor': ['@wangeditor/editor', 'signature_pad'],
          'element-plus': ['element-plus']
        }
      }
    }
  }
})
``` 