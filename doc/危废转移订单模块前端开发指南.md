 # 危废转移订单模块前端开发指南

## 1. 模块概述

### 1.1 功能描述
危废转移订单管理模块是一个完整的业务管理系统，主要用于管理危险废物转移过程中的订单流程，包括订单创建、审批、执行、完成等全生命周期管理。

### 1.2 核心功能
- 转移订单管理（CRUD操作）
- 订单状态流转
- 审批流程管理
- 文件附件管理
- 数据导入导出
- 统计报表功能

## 2. 技术栈要求

### 2.1 前端技术栈
- **框架**: Vue 3 + TypeScript
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **路由管理**: Vue Router 4
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **代码规范**: ESLint + Prettier

### 2.2 开发环境
- Node.js >= 16.0.0
- npm >= 8.0.0 或 yarn >= 1.22.0

## 3. 项目结构

```
src/
├── views/
│   └── waste/
│       └── transfer-order/
│           ├── index.vue           # 列表页面
│           ├── form.vue           # 表单页面（新增/编辑）
│           └── detail.vue         # 详情页面
├── api/
│   └── waste/
│       └── transferOrder.ts       # API接口定义
├── types/
│   └── waste/
│       └── transferOrder.ts       # TypeScript类型定义
└── components/
    └── waste/
        └── transfer-order/
            ├── OrderStatusTag.vue  # 状态标签组件
            ├── OrderForm.vue      # 订单表单组件
            └── FileUpload.vue     # 文件上传组件
```

## 4. 数据模型定义

### 4.1 转移订单实体
```typescript
interface TransferOrderVO {
  id?: number;
  orderNo: string;                    // 订单编号
  wasteType: string;                  // 废物类型
  wasteCode: string;                  // 废物代码
  quantity: number;                   // 数量
  unit: string;                       // 单位
  generatorCompany: string;           // 产废单位
  disposalCompany: string;            // 处置单位
  transportCompany: string;           // 运输单位
  plannedTransferDate: Date;          // 计划转移日期
  actualTransferDate?: Date;          // 实际转移日期
  status: TransferOrderStatus;        // 订单状态
  approvalStatus: ApprovalStatus;     // 审批状态
  remark?: string;                    // 备注
  attachments?: FileInfo[];           // 附件列表
  createTime?: Date;                  // 创建时间
  updateTime?: Date;                  // 更新时间
}

enum TransferOrderStatus {
  DRAFT = 0,        // 草稿
  PENDING = 1,      // 待审批
  APPROVED = 2,     // 已审批
  IN_TRANSIT = 3,   // 运输中
  COMPLETED = 4,    // 已完成
  CANCELLED = 5     // 已取消
}

enum ApprovalStatus {
  PENDING = 0,      // 待审批
  APPROVED = 1,     // 已通过
  REJECTED = 2      // 已拒绝
}
```

## 5. API接口规范

### 5.1 基础CRUD接口
```typescript
// 获取转移订单分页列表
export const getTransferOrderPage = (params: TransferOrderPageReqVO) => {
  return request.get({ url: '/waste/transfer-order/page', params })
}

// 获取转移订单详情
export const getTransferOrder = (id: number) => {
  return request.get({ url: `/waste/transfer-order/get?id=${id}` })
}

// 创建转移订单
export const createTransferOrder = (data: TransferOrderSaveReqVO) => {
  return request.post({ url: '/waste/transfer-order/create', data })
}

// 更新转移订单
export const updateTransferOrder = (data: TransferOrderSaveReqVO) => {
  return request.put({ url: '/waste/transfer-order/update', data })
}

// 删除转移订单
export const deleteTransferOrder = (id: number) => {
  return request.delete({ url: `/waste/transfer-order/delete?id=${id}` })
}
```

### 5.2 业务操作接口
```typescript
// 提交审批
export const submitForApproval = (id: number) => {
  return request.put({ url: `/waste/transfer-order/submit/${id}` })
}

// 审批通过
export const approveOrder = (data: ApprovalReqVO) => {
  return request.put({ url: '/waste/transfer-order/approve', data })
}

// 审批拒绝
export const rejectOrder = (data: ApprovalReqVO) => {
  return request.put({ url: '/waste/transfer-order/reject', data })
}

// 开始转移
export const startTransfer = (id: number) => {
  return request.put({ url: `/waste/transfer-order/start-transfer/${id}` })
}

// 完成转移
export const completeTransfer = (data: CompleteTransferReqVO) => {
  return request.put({ url: '/waste/transfer-order/complete', data })
}
```

## 6. 页面开发规范

### 6.1 列表页面开发要点
```vue
<template>
  <div class="app-container">
    <!-- 搜索表单 -->
    <el-form :model="queryParams" ref="queryFormRef" :inline="true">
      <el-form-item label="订单编号" prop="orderNo">
        <el-input v-model="queryParams.orderNo" placeholder="请输入订单编号" />
      </el-form-item>
      <el-form-item label="订单状态" prop="status">
        <el-select v-model="queryParams.status" placeholder="请选择状态">
          <el-option label="全部" value="" />
          <el-option 
            v-for="dict in getIntDictOptions(DICT_TYPE.WASTE_TRANSFER_ORDER_STATUS)"
            :key="dict.value" 
            :label="dict.label" 
            :value="dict.value" 
          />
        </el-select>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="handleQuery">搜索</el-button>
        <el-button @click="resetQuery">重置</el-button>
      </el-form-item>
    </el-form>

    <!-- 操作工具栏 -->
    <el-row :gutter="10" class="mb8">
      <el-col :span="1.5">
        <el-button type="primary" @click="openForm('create')">新增</el-button>
      </el-col>
      <el-col :span="1.5">
        <el-button type="success" @click="handleExport">导出</el-button>
      </el-col>
    </el-row>

    <!-- 数据表格 -->
    <el-table v-loading="loading" :data="list">
      <el-table-column label="订单编号" prop="orderNo" />
      <el-table-column label="废物类型" prop="wasteType" />
      <el-table-column label="数量" prop="quantity" />
      <el-table-column label="状态" prop="status">
        <template #default="scope">
          <OrderStatusTag :status="scope.row.status" />
        </template>
      </el-table-column>
      <el-table-column label="创建时间" prop="createTime" />
      <el-table-column label="操作" fixed="right" width="200">
        <template #default="scope">
          <el-button type="primary" link @click="openDetail(scope.row.id)">
            详情
          </el-button>
          <el-button type="primary" link @click="openForm('update', scope.row.id)">
            编辑
          </el-button>
          <el-button type="danger" link @click="handleDelete(scope.row.id)">
            删除
          </el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页组件 -->
    <Pagination
      :total="total"
      v-model:page="queryParams.pageNo"
      v-model:limit="queryParams.pageSize"
      @pagination="getList"
    />
  </div>
</template>
```

### 6.2 表单页面开发要点
```vue
<template>
  <el-dialog :title="dialogTitle" v-model="dialogVisible" width="800px">
    <el-form ref="formRef" :model="formData" :rules="formRules" label-width="120px">
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="废物类型" prop="wasteType">
            <el-input v-model="formData.wasteType" placeholder="请输入废物类型" />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="废物代码" prop="wasteCode">
            <el-input v-model="formData.wasteCode" placeholder="请输入废物代码" />
          </el-form-item>
        </el-col>
      </el-row>
      
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="数量" prop="quantity">
            <el-input-number v-model="formData.quantity" :min="0" :precision="2" />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="单位" prop="unit">
            <el-select v-model="formData.unit" placeholder="请选择单位">
              <el-option label="吨" value="ton" />
              <el-option label="千克" value="kg" />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>

      <!-- 文件上传组件 -->
      <el-form-item label="附件">
        <FileUpload v-model="formData.attachments" :limit="5" />
      </el-form-item>
    </el-form>

    <template #footer>
      <el-button @click="dialogVisible = false">取消</el-button>
      <el-button type="primary" @click="submitForm">确定</el-button>
    </template>
  </el-dialog>
</template>
```

## 7. 组件开发规范

### 7.1 状态标签组件
```vue
<!-- OrderStatusTag.vue -->
<template>
  <el-tag :type="tagType" :effect="tagEffect">
    {{ statusText }}
  </el-tag>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { TransferOrderStatus } from '@/types/waste/transferOrder'

interface Props {
  status: TransferOrderStatus
}

const props = defineProps<Props>()

const statusConfig = {
  [TransferOrderStatus.DRAFT]: { text: '草稿', type: 'info', effect: 'plain' },
  [TransferOrderStatus.PENDING]: { text: '待审批', type: 'warning', effect: 'plain' },
  [TransferOrderStatus.APPROVED]: { text: '已审批', type: 'success', effect: 'plain' },
  [TransferOrderStatus.IN_TRANSIT]: { text: '运输中', type: 'primary', effect: 'plain' },
  [TransferOrderStatus.COMPLETED]: { text: '已完成', type: 'success', effect: 'dark' },
  [TransferOrderStatus.CANCELLED]: { text: '已取消', type: 'danger', effect: 'plain' }
}

const statusText = computed(() => statusConfig[props.status]?.text || '未知')
const tagType = computed(() => statusConfig[props.status]?.type || 'info')
const tagEffect = computed(() => statusConfig[props.status]?.effect || 'plain')
</script>
```

## 8. 开发注意事项

### 8.1 数据验证
- 所有表单必须进行前端验证
- 数量字段必须为正数
- 日期字段必须符合格式要求
- 必填字段不能为空

### 8.2 权限控制
- 根据用户角色显示不同操作按钮
- 使用 `v-hasPermi` 指令控制按钮权限
- 状态流转需要验证用户权限

### 8.3 错误处理
- 统一使用 try-catch 处理异步操作
- 网络错误需要友好提示
- 表单验证失败需要明确提示

### 8.4 性能优化
- 列表数据使用分页加载
- 大文件上传需要进度提示
- 合理使用 v-show 和 v-if

## 9. 测试要求

### 9.1 单元测试
- 组件渲染测试
- 方法功能测试
- 数据验证测试

### 9.2 集成测试
- API接口调用测试
- 页面跳转测试
- 权限控制测试

## 10. 部署说明

### 10.1 构建命令
```bash
# 开发环境
npm run dev

# 生产构建
npm run build

# 预览构建结果
npm run preview
```

### 10.2 环境配置
- 开发环境：`.env.development`
- 生产环境：`.env.production`
- 测试环境：`.env.test`

---

**注意**: 本文档基于 Vue 3 + Element Plus 技术栈，开发过程中请严格遵循代码规范和最佳实践。